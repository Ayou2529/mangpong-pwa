const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/login-CEmfbn00.js","assets/errors-CDwa38fn.js","assets/config-d4aAC8yj.js","assets/register-x4Gtd8cJ.js"])))=>i.map(i=>d[i]);
import"./config-d4aAC8yj.js";const q="modulepreload",k=function(e){return"/"+e},T={},$=function(t,n,o){let s=Promise.resolve();if(n&&n.length>0){let p=function(a){return Promise.all(a.map(l=>Promise.resolve(l).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),c=i?.nonce||i?.getAttribute("nonce");s=p(n.map(a=>{if(a=k(a),a in T)return;T[a]=!0;const l=a.endsWith(".css"),f=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${f}`))return;const d=document.createElement("link");if(d.rel=l?"stylesheet":q,l||(d.as="script"),d.crossOrigin="",d.href=a,c&&d.setAttribute("nonce",c),document.head.appendChild(d),l)return new Promise((S,v)=>{d.addEventListener("load",S),d.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${a}`)))})}))}function r(i){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=i,window.dispatchEvent(c),!c.defaultPrevented)throw i}return s.then(i=>{for(const c of i||[])c.status==="rejected"&&r(c.reason);return t().catch(r)})};function h(e,t){try{return localStorage.setItem(e,t),!0}catch(n){if(console.error("localStorage setItem failed:",n),R())try{const o=JSON.parse(y("mangpongJobs")||"[]");if(o.length>10){const s=o.slice(-10);return h("mangpongJobs",JSON.stringify(s)),h(e,t),!0}}catch(o){console.error("localStorage cleanup failed:",o)}return!1}}function y(e,t=null){try{return localStorage.getItem(e)||t}catch(n){return console.error("localStorage getItem failed:",n),t}}function D(e){try{return localStorage.removeItem(e),!0}catch(t){return console.error("localStorage removeItem failed:",t),!1}}function R(){return/iPad|iPhone|iPod/.test(navigator.userAgent)||navigator.userAgent.includes("Mac")&&navigator.maxTouchPoints>1}const w={requests:[],isProcessing:!1,add:function(e){this.requests.push({data:e,timestamp:Date.now(),attempts:0}),this.saveToStorage()},process:async function(){if(!(this.isProcessing||this.requests.length===0||!navigator.onLine)){this.isProcessing=!0;try{for(;this.requests.length>0;){const e=this.requests[0];e.attempts++;try{await B(e.data),this.requests.shift(),this.saveToStorage()}catch{e.attempts>=3?(this.requests.shift(),this.saveToStorage()):await new Promise(t=>setTimeout(t,1e3*e.attempts))}}}finally{this.isProcessing=!1}}},saveToStorage:function(){try{h("mangpongRequestQueue",JSON.stringify(this.requests))}catch{}},loadFromStorage:function(){try{const e=y("mangpongRequestQueue");e&&(this.requests=JSON.parse(e))}catch{}},clear:function(){this.requests=[],this.saveToStorage()}};async function x(e){return navigator.onLine?_(e,3):(w.add(e),Promise.resolve({success:!0,message:"Request queued for later processing"}))}async function _(e,t=3){for(let n=1;n<=t;n++)try{return await B(e)}catch{if(n===t)return w.add(e),{success:!0,message:"Request queued for later processing"};const o=Math.min(1e3*Math.pow(2,n-1),1e4);await new Promise(s=>setTimeout(s,o))}}function F(e){return new Promise(n=>{setTimeout(()=>{const o=U(e);n(o)},1e3)})}function U(e){switch(e.action){case"login":return G(e);case"register":return{success:!0,message:"ลงทะเบียนสำเร็จ"};case"createJob":return{success:!0,message:"บันทึกงานสำเร็จ",jobId:"JOB-"+Date.now()};case"getJobs":return{success:!0,jobs:[{jobId:"JOB-001",timestamp:new Date().toISOString(),status:"complete",jobDate:new Date().toISOString(),company:"ทดสอบ บริษัท",assignedBy:"ทดสอบ ผู้สั่งงาน",contact:"0123456789",pickupProvince:"กรุงเทพมหานคร",pickupDistrict:"บางนา",totalAmount:1e3}]};default:return{success:!0,message:"ดำเนินการสำเร็จ"}}}function G(e){return e.username==="admin"&&e.password==="password"?{success:!0,user:{username:"admin",fullName:"Admin User",role:"Admin"}}:e.username==="messenger"&&e.password==="password"?{success:!0,user:{username:"messenger",fullName:"Messenger User",role:"Messenger"}}:{success:!1,error:"ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง"}}async function B(e){if(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")return F(e);if(!window.GOOGLE_SCRIPT_URL)throw new Error("Google Script URL ไม่ได้ถูกกำหนดไว้");try{const n=await fetch(window.GOOGLE_SCRIPT_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return await n.json()}catch(n){throw new Error(`ไม่สามารถเชื่อมต่อกับ Google Apps Script ได้: ${n.message}`)}}const Ee=Object.freeze(Object.defineProperty({__proto__:null,requestQueue:w,submitToGoogleSheets:x,submitToGoogleSheetsInternal:B},Symbol.toStringTag,{value:"Module"}));function O(){const e=new Date,t=e.getFullYear()+543,n=["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],s=["อาทิตย์","จันทร์","อังคาร","พุธ","พฤหัสบดี","ศุกร์","เสาร์"][e.getDay()],r=e.getDate(),i=n[e.getMonth()],c=t,p=String(e.getHours()).padStart(2,"0"),a=String(e.getMinutes()).padStart(2,"0"),l=`${s} ${r} ${i} ${c} ${p}:${a}`,f=document.getElementById("current-date-time");f&&(f.textContent=l);const d=`${i} ${c}`,S=document.getElementById("current-month");S&&(S.textContent=d);const v=document.getElementById("selected-date");v&&(v.value=P(e));const L=document.getElementById("job-date-picker");L&&(L.value=P(e))}function P(e){const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${o}`}function H(e){const t=new Date(e),n=t.getFullYear()+543,o=["ม.ค.","ก.พ.","มี.ค.","เม.ย.","พ.ค.","มิ.ย.","ก.ค.","ส.ค.","ก.ย.","ต.ค.","พ.ย.","ธ.ค."],s=t.getDate(),r=o[t.getMonth()];return`${s}/${r}/${n}`}let N="login-screen";function J(e){N=e,["login-screen","register-screen","app"].forEach(n=>{const o=document.getElementById(n);o?n===N?o.classList.remove("hidden"):o.classList.add("hidden"):console.warn(`Page element with ID '${n}' not found`)})}function I(e){const t=document.getElementById("home-screen"),n=document.getElementById("new-job-screen"),o=document.getElementById("history-screen");t&&t.classList.add("hidden"),n&&n.classList.add("hidden"),o&&o.classList.add("hidden");const s=document.getElementById(e);if(s&&s.classList.remove("hidden"),document.querySelectorAll(".nav-item").forEach(r=>{r.classList.remove("active")}),e==="home-screen"){const r=document.querySelectorAll(".nav-item")[0];r&&r.classList.add("active")}else if(e==="new-job-screen"){const r=document.querySelectorAll(".nav-item")[1];r&&r.classList.add("active");const i=document.getElementById("edit-job-id").value;i&&console.log("Entering edit mode for job:",i)}else if(e==="history-screen"){const r=document.querySelectorAll(".nav-item")[2];r&&r.classList.add("active")}}function Y(){const e=document.getElementById("edit-job-id");e&&(e.value=""),I("new-job-screen")}function z(){const e=document.getElementById("edit-job-id");e&&(e.value=""),I("home-screen")}function j(e){if(!e){console.warn("No job ID provided for editJob");return}try{const t=document.getElementById("edit-job-id");t&&(t.value=e),I("new-job-screen"),console.log("Entering edit mode for job:",e)}catch(t){console.error("Error editing job:",t),Swal.fire({icon:"error",title:"เกิดข้อผิดพลาด",text:`ไม่สามารถแก้ไขงานได้: ${t.message}`,confirmButtonText:"ตกลง",confirmButtonColor:"#ef4444"})}}function Q(){}let g=null,m=null,b=0;const W=300*1e3;function K(){const e=document.querySelectorAll(".amount-input");let t=0;e.forEach(s=>{const r=parseFloat(s.value)||0;t+=r});const n=document.getElementById("total-amount");n&&(n.textContent=`${t.toFixed(2)} บาท`);const o=document.getElementById("main-service-fee");o&&(o.textContent=`${t.toFixed(2)} บาท`)}function M(){O(),V(!0),he(),ne(!0),document.querySelectorAll(".amount-input").forEach(e=>{e&&e.addEventListener("input",K)}),setInterval(()=>{navigator.onLine&&te()},300*1e3)}async function V(e=!1){const t=await A(e),n=Array.isArray(t)?t:[],o=n.filter(r=>r&&r.status==="incomplete"),s=n.filter(r=>r&&r.status==="draft");await C("incomplete",o),await C("draft",s)}async function C(e,t){const n=e==="incomplete"?"incomplete-jobs-card":"draft-jobs-card",o=e==="incomplete"?"incomplete-jobs-list":"draft-jobs-list",s=document.getElementById(n),r=document.getElementById(o);s&&r&&(t.length>0?(s.classList.remove("hidden"),r.innerHTML="",t.forEach(i=>{if(i){const c=document.createElement("li");c.textContent=`${i.jobId}: ${i[e==="incomplete"?"incompleteReason":"company"]||(e==="incomplete"?"ข้อมูลไม่ครบถ้วน":"ไม่ระบุบริษัท")}`,c.className="cursor-pointer hover:text-indigo-600",c.onclick=function(){j(i.jobId)},r.appendChild(c)}})):s.classList.add("hidden"))}async function A(e=!1){const t=Date.now();if(!e&&m&&t-b<W)return m||[];if(!navigator.onLine&&m)return m||[];try{return await X(t)}catch{return await ee(t)}}async function X(e){const t=await x({action:"getJobs",username:g?g.username:""});if(t&&t.success&&t.jobs){const n=Array.isArray(t.jobs)?t.jobs:[];return m=n,b=e,h("mangpongJobs",JSON.stringify(n)),n}else return await Z()}async function Z(){if(m)return m||[];const e=y("mangpongJobs");if(e)try{const t=JSON.parse(e),n=Array.isArray(t)?t:[];return m=n,b=Date.now(),n}catch{}return[]}async function ee(e){if(m)return m||[];const t=y("mangpongJobs");if(t)try{const n=JSON.parse(t),o=Array.isArray(n)?n:[];return m=o,b=e,o}catch{}return[]}async function te(){try{if(!g||!g.username)return;const e=await x({action:"getJobs",username:g.username});if(e&&e.success&&e.jobs){const t=Array.isArray(e.jobs)?e.jobs:[];m=t,b=Date.now(),h("mangpongJobs",JSON.stringify(t))}}catch{}}async function ne(e=!1){Swal.fire({title:"กำลังโหลดประวัติงาน...",allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1,didOpen:()=>{Swal.showLoading()}});try{const t=await A(e),n=document.getElementById("job-history-container"),o=document.getElementById("no-jobs-message");n&&o&&await oe(t,n,o),Swal.close()}catch(t){Swal.fire({icon:"error",title:"เกิดข้อผิดพลาด",text:t.message,confirmButtonText:"ตกลง",confirmButtonColor:"#ef4444"})}}async function oe(e,t,n){const o=Array.isArray(e)?e:[];if(o.length===0){se(n),E();return}re(n);const s=ae(o);if(ie(t),s.length===0){ce(n),E();return}le(s,t,n),ue()}function se(e){e.style.display="block",Swal.close(),E()}function re(e){e.style.display="none"}function ae(e){e.sort((n,o)=>{const s=n&&n.timestamp?new Date(n.timestamp||0):new Date(0);return(o&&o.timestamp?new Date(o.timestamp||0):new Date(0))-s});const t=new Date;return t.setDate(t.getDate()-30),e.filter(n=>!n||!n.timestamp?!1:new Date(n.timestamp)>=t)}function ie(e){e.querySelectorAll(".job-item").forEach(n=>n.remove())}function ce(e){e.style.display="block",e.querySelector("p:first-of-type").textContent="ไม่พบประวัติงานใน 30 วันล่าสุด",Swal.close(),E()}function le(e,t,n){e.forEach(o=>{if(o){const s=de(o);t.insertBefore(s,n)}})}function ue(){const e=document.getElementById("export-pdf-btn"),t=document.getElementById("export-pdf-btn-mobile");e&&(e.style.display="block"),t&&(t.style.display="block")}function E(){const e=document.getElementById("export-pdf-btn"),t=document.getElementById("export-pdf-btn-mobile");e&&(e.style.display="none"),t&&(t.style.display="none")}function de(e){if(!e)return document.createElement("div");const t=document.createElement("div");t.className="card bg-white p-4 mb-4 job-item",t.setAttribute("data-status",e.status||"complete");const n=pe(e.status),o=e.timestamp?H(e.timestamp):"ไม่ระบุวันที่";return t.innerHTML=me(e,n,o),t}function me(e,t,n){return`
    <div class="flex justify-between items-start mb-1">
      <h3 class="font-medium">${e.jobId||"ไม่ระบุ ID"}</h3>
      <span class="px-2 py-1 text-xs rounded-full ${t.class}">${t.text}</span>
    </div>
    <div class="text-sm text-gray-600 mb-2">
      <p>วันที่: ${n}</p>
      <p>บริษัท: ${e.company||"ไม่ระบุ"}</p>
      <p>ผู้ติดต่อ: ${e.assignedBy||"ไม่ระบุ"}</p>
      <p>จำนวน: ${e.totalAmount?e.totalAmount.toFixed(2):"0.00"} บาท</p>
    </div>
    ${fe(e)}
    <div class="flex space-x-2">
      <button class="text-sm text-indigo-600 font-medium flex items-center touch-target" onclick="editJob('${e.jobId||""}')">
        ${ge(e)}
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
        </svg>
      </button>
    </div>
  `}function fe(e){return e.status==="incomplete"?`
      <div class="bg-red-50 border-l-4 border-red-500 p-2 text-sm text-red-700 mb-2">
        <p>เหตุผลไม่สมบูรณ์: ${e.incompleteReason||"ข้อมูลไม่ครบถ้วน"}</p>
      </div>
    `:e.status==="draft"?`
      <div class="bg-amber-50 border-l-4 border-amber-500 p-2 text-sm text-amber-700 mb-2">
        <p>สถานะ: บันทึกเป็นร่าง</p>
      </div>
    `:""}function ge(e){return e.status==="draft"?"แก้ไขร่าง":e.status==="incomplete"?"แก้ไขงานไม่สมบูรณ์":"แก้ไขงาน"}function pe(e){switch(e){case"incomplete":return{class:"incomplete-badge",text:"ไม่สมบูรณ์"};case"draft":return{class:"draft-badge",text:"ร่าง"};default:return{class:"complete-badge",text:"สมบูรณ์"}}}async function he(){try{const e=await A(),t=Array.isArray(e)?e:[],n=new Date,o=n.toDateString(),s=ye(t,n,o);we(s,n)}catch{}}function ye(e,t,n){const o=e.filter(a=>!a||!a.timestamp?!1:new Date(a.timestamp).toDateString()===n).length,s=e.filter(a=>!a||!a.timestamp?!1:new Date(a.timestamp).toDateString()===n&&a.status==="complete").length,r=t.getMonth(),i=t.getFullYear(),c=e.filter(a=>{if(!a||!a.timestamp)return!1;const l=new Date(a.timestamp);return l.getMonth()===r&&l.getFullYear()===i}).length,p=e.length;return{jobsToday:o,completedToday:s,monthlyJobs:c,totalJobs:p}}function we(e,t){const{jobsToday:n,completedToday:o,monthlyJobs:s,totalJobs:r}=e,i=document.getElementById("jobs-today");i&&(i.textContent=n);const c=document.getElementById("completed-today");c&&(c.textContent=o);const p=document.getElementById("monthly-jobs");p&&(p.textContent=s+" งาน");const a=document.getElementById("total-jobs");a&&(a.textContent=r+" งาน");const l=document.getElementById("current-month");if(l){const f=["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],d=t.getFullYear()+543;l.textContent=`${f[t.getMonth()]} ${d}`}}function u(){Se()||J("login-screen"),setInterval(O,6e4),be(),w.loadFromStorage()}function be(){window.addEventListener("online",function(){w.process()});const e=document.getElementById("login-form");if(e){const n=e.cloneNode(!0);e.parentNode.replaceChild(n,e),n.addEventListener("submit",async function(o){o.preventDefault();const{handleLogin:s}=await $(async()=>{const{handleLogin:r}=await import("./login-CEmfbn00.js");return{handleLogin:r}},__vite__mapDeps([0,1,2]));await s(o)})}const t=document.getElementById("register-form");if(t){const n=t.cloneNode(!0);t.parentNode.replaceChild(n,t),n.addEventListener("submit",async function(o){o.preventDefault();const{handleRegister:s}=await $(async()=>{const{handleRegister:r}=await import("./register-x4Gtd8cJ.js");return{handleRegister:r}},__vite__mapDeps([3,1,2]));await s(o)})}}function Se(){const e=y("mangpongUser");if(e)try{g=JSON.parse(e),J("app");const t=document.getElementById("user-display-name");return t&&(t.textContent=g.fullName||g.username),M(),!0}catch{D("mangpongUser")}return!1}u.showPage=J;u.showScreen=I;u.logout=function(){g=null,D("mangpongUser"),D("mangpongJobs"),J("login-screen")};u.startNewJob=Y;u.editJob=j;u.viewJob=Q;u.cancelEdit=z;window.initializeApp=M;window.showPage=u.showPage;window.showScreen=u.showScreen;window.logout=u.logout;window.startNewJob=u.startNewJob;window.editJob=u.editJob;window.viewJob=u.viewJob;window.cancelEdit=u.cancelEdit;document.addEventListener("DOMContentLoaded",u);export{$ as _,J as a,Ee as b,h as s};
