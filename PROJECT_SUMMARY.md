# ข้อมูลที่ควรรู้สำหรับโปรเจค แมงป่อง (Mangpong Trading PWA)

## 1. ภาพรวมของโปรเจค

### วัตถุประสงค์
- ลดการเขียนเอกสารกระดาษของแมสเซ็นเจอร์
- ลดการคีย์ข้อมูลซ้ำของพนักงาน
- ใช้ PWA (HTML/CSS/JS) ให้แมสเซ็นเจอร์บันทึกงานจากมือถือ
- เก็บข้อมูลเข้าสู่ Google Sheet โดยอัตโนมัติ
- พนักงานดูข้อมูลรวมใน Google Sheet / Dashboard เพื่อนำไปออกบิลและคิดเงินเดือน

### เทคโนโลยีที่ใช้
- **Frontend**: HTML5, CSS3, JavaScript (ES6+)
- **UI Framework**: Tailwind CSS
- **แจ้งเตือน**: SweetAlert2
- **Font**: Prompt (Google Fonts)
- **PWA**: Service Worker, Manifest, Offline Support
- **Backend**: Google Apps Script
- **Database**: Google Sheets

## 2. บทบาทผู้ใช้งาน

### 1. แมสเซ็นเจอร์ (Mobile First)
**ฟีเจอร์ที่มี:**
- ล็อกอิน/สมัครสมาชิก
- หน้าหลัก (สรุปงานวันนี้ + ยอดรวม)
- ฟอร์มบันทึกงานใหม่ (รับ/ส่ง, บริษัทลูกค้า, ผู้มอบงาน, รายละเอียด, ค่าบริการ, แนบรูป)
- ประวัติงานย้อนหลัง
- อัปโหลดรูป
- แก้ไขงาน

**หน้าจอที่มี:**
- Login Screen
- Register Screen
- Home Screen (Dashboard)
- New Job Screen
- History Screen
- Edit Job Screen

### 2. พนักงาน (Admin)
**ฟีเจอร์ที่ควรมี (ยังไม่ได้ทำ):**
- เห็นข้อมูลจาก Google Sheet อัตโนมัติ → Master Sheet → แยกเป็น 5 แท็บบริษัท + 2 แท็บแมสเซ็นเจอร์
- Dashboard: เลือกบริษัท/แมสเซ็นเจอร์ + เดือน → ตารางงาน + รวมยอด → ปุ่ม "ออกบิล" / "ออกเงินเดือน"
- Export PDF อัตโนมัติ

### 3. อา (เจ้าของ)
**ฟีเจอร์ที่ควรมี (ยังไม่ได้ทำ):**
- Dashboard ภาพรวมรายเดือน → สรุปงานรายบริษัท + รายแมสเซ็นเจอร์
- ตรวจสอบ + อนุมัติการจ่ายเงินเดือน
- ตรวจบิลก่อนส่งลูกค้า

## 3. โครงสร้างฐานข้อมูล (Google Sheets)

### ชีตต่างๆ:
1. **Jobs** - เก็บข้อมูลงานหลัก
2. **JobDetails** - เก็บรายละเอียดงานแต่ละรายการ
3. **AdditionalFees** - เก็บข้อมูลค่าบริการเพิ่มเติม
4. **Users** - เก็บข้อมูลผู้ใช้งาน
5. **JobHistory** - เก็บประวัติการเปลี่ยนแปลงข้อมูลงาน

### โครงสร้างตาราง Users:
- username, password, fullName, phone, email, createdAt, lastLogin

### โครงสร้างตาราง Jobs:
- timestamp, jobDate, jobId, username, company, assignedBy, contact, pickupProvince, pickupDistrict
- status, incompleteReason, mainServiceFee, additionalFeesTotal, totalAmount
- jobCount, feeCount
- companyTo1-5, province1-5, district1-5, recipient1-5, detail1-5, amount1-5
- feeName1-10, feeAmount1-10

## 4. Flow ข้อมูล

### แมสเซ็นเจอร์กรอก → Master Sheet → Query/Filter อัตโนมัติ → 5 แท็บบริษัท + 2 แท็บแมสเซ็นเจอร์ → พนักงานออกบิล/เงินเดือน → เจ้าของอนุมัติ

### Output:
- ใบวางบิล (PDF) รายบริษัท
- สลิปเงินเดือน (PDF) รายแมสเซ็นเจอร์

## 5. ระบบเงินเดือน

### โครงสร้างการแบ่งรายได้ (70/30):
- **แมสเซ็นเจอร์ได้ 70%** ของยอดรวมค่าบริการ
- **บริษัท แมงป่อง ได้ 30%** ของยอดรวมค่าบริการ

### รายละเอียดระบบเงินเดือน:

#### เงินได้:
1. **ฐานเงินเดือน**: 15,000 บาท
2. **สวัสดิการค่าอาหาร**: (ไม่ระบุจำนวน)
3. **เงินพิเศษ (ค่าเที่ยว)**: ส่วนต่างจากยอด 70% ลบด้วยฐานเงินเดือน

#### วิธีการคำนวณ:
- ถ้า 70% ของยอดงาน ≥ 15,000 บาท: ได้รับเงินพิเศษ
- ถ้า 70% ของยอดงาน < 15,000 บาท: จะนำส่วนต่างมาหัก

#### ยอดหัก:
1. **ประกันสังคม**: 5% จากฐานเงินเดือน (หักไม่เกิน 750 บาท)
2. **หักจ่ายอื่นๆ**: กรณีที่ 70% ไม่ถึง 15,000 บาท จะหักส่วนต่าง

### ตัวอย่างการคำนวณ:
**ตัวอย่าง 1:** ถ้าแมสเซ็นเจอร์ทำยอดรวมค่าบริการ 25,000 บาท:
- 70% = 17,500 บาท
- ฐานเงินเดือน = 15,000 บาท
- เงินพิเศษ = 17,500 - 15,000 = 2,500 บาท
- รวมรับ = 15,000 + 2,500 = 17,500 บาท
- หักประกันสังคม = 750 บาท (สูงสุด)
- สุทธิ = 17,500 - 750 = 16,750 บาท

**ตัวอย่าง 2:** ถ้าแมสเซ็นเจอร์ทำยอดรวมค่าบริการ 18,000 บาท:
- 70% = 12,600 บาท
- ฐานเงินเดือน = 15,000 บาท
- ส่วนต่างที่ต้องหัก = 15,000 - 12,600 = 2,400 บาท
- หักประกันสังคม = 630 บาท (5% ของ 12,600)
- สุทธิ = 12,600 - 630 - 2,400 = 9,570 บาท

## 6. ข้อมูลการเชื่อมต่อ

### Google Apps Script URL
```
https://script.google.com/macros/s/AKfycbwrfLlkWHqe2CkRjOH3iQpBVynXZHWkbjcVxmr-V25rtwkuQYIFj0UAznWadCPnDbQN/exec
```

### Spreadsheet ID
```
1fcq5P7vm3IxtJMDS9BLDwO8B14hFmmDdK257GHyoM
```

### Actions ที่รองรับ
- login
- register
- createJob
- updateJob
- getJobs
- getJobById

## 7. ข้อเสนอแนะ

### เร่งด่วน:
1. เพิ่มระบบ Admin Dashboard ใน PWA สำหรับพนักงาน
2. เพิ่มระบบ Owner Dashboard ใน PWA สำหรับเจ้าของ
3. พัฒนาระบบ Export PDF สำหรับใบวางบิลและสลิปเงินเดือน
4. เพิ่มระบบ Query/Filter อัตโนมัติใน Google Sheets
5. ปรับปรุงความปลอดภัยของระบบ Authentication (hash password)

### ระยะกลาง:
1. จัดระเบียบโครงสร้างไฟล์และเพิ่มระบบ build (Webpack/Vite)
2. เพิ่มระบบจัดการ state (Vuex หรือ Context API)
3. เพิ่มระบบแจ้งเตือนแบบ Push Notification สำหรับแมสเซ็นเจอร์
4. พัฒนาระบบรายงานและ Dashboard ที่ซับซ้อนขึ้น

### ระยะยาว:
1. พิจารณาการย้ายไปใช้ระบบฐานข้อมูลที่เหมาะสมกว่า Google Sheets (เช่น Firebase, MongoDB)
2. พัฒนาแอป Native แยกต่างหากสำหรับแต่ละบทบาท
3. เพิ่มระบบจัดการผู้ใช้แบบ Role-based Access Control

## 8. Wireframes หน้าจอ

### หน้า Login และ Register
```
+-------------------------------------------------+
|              แมงป่อง เทรดดิ้ง                   |
|              Mangpong Delivery System           |
|                                                 |
|  [ชื่อผู้ใช้_____________________________]       |
|                                                 |
|  [รหัสผ่าน_____________________________]        |
|                                                 |
|         [         เข้าสู่ระบบ          ]        |
|                                                 |
|       ยังไม่มีบัญชี? สมัครสมาชิก                |
+-------------------------------------------------+
```

### Home Screen สำหรับ Messenger
```
+-------------------------------------------------+
| [<=] แมงป่อง เทรดดิ้ง                 [Logout]  |
|      Mangpong Delivery WebApp V1.0            X |
|      TTW Source 1.0                           X |
+-------------------------------------------------+
| [📅 วันจันทร์ 15 กรกฎาคม 2567 14:30]         |
+-------------------------------------------------+
| รับงานวันนี้        |  ส่งงานวันนี้             |
|        5            |         3                 |
+-------------------------------------------------+
|           เมนูทางลัด                            |
|                                                 |
| [+] งานใหม่                                    |
|                                                 |
| [📋 ประวัติ]                                    |
+-------------------------------------------------+
| รายงานประจำเดือน กรกฎาคม 2567                 |
| งานทั้งหมด (ปัจจุบัน): 25                     |
| งานทั้งหมด: 150                               |
+-------------------------------------------------+
| [📝 งานที่บันทึกเป็นแบบร่าง]                   |
| - JOB-12345: บจก.เวอริโฟน (ชั้น 3.2)         |
| - JOB-12346: บจก.ไอมาร์ค                      |
| [แก้ไข >]                                       |
+-------------------------------------------------+
| [⚠️ งานที่บันทึกไม่สมบูรณ์]                    |
| - JOB-12347: ข้อมูลไม่ครบถ้วน                  |
| [แก้ไข >]                                       |
+-------------------------------------------------+
| [🏠 หน้าหลัก] [+] [📋 ประวัติ]                 |
+-------------------------------------------------+
```

### New Job Screen
```
+-------------------------------------------------+
| [<] บันทึกงานใหม่                              |
+-------------------------------------------------+
| วันที่บันทึกงาน                                 |
| [2024-07-15_____________________________]       |
| ⓘ สามารถเลือกวันที่เพื่อบันทึกงานย้อนหลังได้  |
+-------------------------------------------------+
| ข้อมูลการรับงาน                                 |
|                                                 |
| บริษัท/สถานที่รับงาน                           |
| [เลือกบริษัท v]                                 |
| ▼ บจก.เวอริโฟน (ชั้น 3.2)                      |
|   บจก.เวอริโฟน (ชั้น 20)                        |
|   บจก.ไอมาร์ค                                   |
|   บจก.สนง.ทองทวี                                |
|   บจก.ออฟฟิศเอที                                |
|                                                 |
| ผู้มอบงาน                                       |
| [ชื่อผู้มอบงาน__________________________]       |
|                                                 |
| ข้อมูลติดต่อ                                    |
| [ข้อมูลติดต่อ___________________________]       |
|                                                 |
| สถานที่รับของ                                   |
| จังหวัดรับของ                                   |
| [จังหวัด________________________________]      |
|                                                 |
| เขต/อำเภอรับของ                                |
| [เขต/อำเภอ_____________________________]       |
+-------------------------------------------------+
| ค่าบริการหลัก (Main Service Fee)                |
|                                                 |
| รายละเอียดงาน #1                               |
| [x]                                             |
| บริษัทปลายทาง                                   |
| [ชื่อบริษัทปลายทาง______________________]      |
|                                                 |
| จังหวัดส่งของ                                   |
| [จังหวัด________________________________]      |
|                                                 |
| เขต/อำเภอส่งของ                                |
| [เขต/อำเภอ_____________________________]       |
|                                                 |
| ผู้รับงาน                                       |
| [ชื่อผู้รับงาน__________________________]       |
|                                                 |
| รายละเอียด                                     |
| [รายละเอียดงาน_________________________]       |
| [_______________________________________]      |
|                                                 |
| จำนวนเงิน (บาท)                                |
| [0.00___________________________________]      |
|                                                 |
| [+] เพิ่มรายการ (สูงสุด 5)                     |
+-------------------------------------------------+
| สรุปค่าบริการ                                   |
| ค่าบริการหลัก: 0 บาท                           |
|                                                 |
| รวมค่าบริการเพิ่มเติม:                         |
|                                                 |
| [+] เพิ่มค่าบริการเพิ่มเติม                    |
|                                                 |
| รวมทั้งหมด: 0 บาท                              |
+-------------------------------------------------+
| [ยกเลิก] [บันทึกงาน]                           |
+-------------------------------------------------+
|                    [บันทึกแบบร่าง]             O |
+-------------------------------------------------+
```

### Admin Dashboard (ที่ควรมี)
```
+-------------------------------------------------+
| [<] Admin Dashboard                            |
+-------------------------------------------------+
| บริษัท: [เลือกบริษัท v]      เดือน: [เลือกเดือน v] |
| ▼ บจก.เวอริโฟน (ชั้น 3.2)     ▼ กรกฎาคม 2567      |
|   บจก.เวอริโฟน (ชั้น 20)                          |
|   บจก.ไอมาร์ค                                     |
|   บจก.สนง.ทองทวี                                  |
|   บจก.ออฟฟิศเอที                                  |
+-------------------------------------------------+
| สรุปงาน                                         |
| จำนวนงาน: 25                                   |
| ยอดรวม: 35,500.00 บาท                          |
+-------------------------------------------------+
| ตารางงาน                                        |
| วันที่    | รหัสงาน  | ผู้รับงาน | ยอดเงิน     |
| 15/ก.ค.  | JOB-12345| นายสุนทรอย | 1,500.00 บาท |
| 14/ก.ค.  | JOB-12346| นายสุนทรอย | 2,300.00 บาท |
| 14/ก.ค.  | JOB-12347| นายวิชัย   |   950.00 บาท |
| 13/ก.ค.  | JOB-12348| นายสุนทรอย | 1,200.00 บาท |
| ...                                             |
+-------------------------------------------------+
| [พิมพ์ใบวางบิล] [ส่งออก PDF] [Excel]           |
+-------------------------------------------------+
| สรุปยอดเงินเดือนแมสเซ็นเจอร์                    |
| นายสุนทรอย: 15,500.00 บาท                       |
| นายวิชัย: 8,750.00 บาท                          |
| ...                                             |
+-------------------------------------------------+
| [พิมพ์สลิปเงินเดือน] [ส่งออก PDF] [Excel]      |
+-------------------------------------------------+
```

## 9. จุดแข็งและจุดที่ควรปรับปรุง

### จุดแข็ง:
- ใช้เทคโนโลยี PWA ที่เหมาะสมกับเป้าหมาย
- มี Service Worker สำหรับการทำงานแบบ Offline
- UI ออกแบบมาให้ใช้งานบนมือถือได้ดี
- มีระบบจัดการข้อมูลแบบ LocalStorage สำหรับ Offline mode
- สามารถบันทึกงานแบบ Offline ได้

### จุดที่ควรปรับปรุง:
- โครงสร้างไฟล์ค่อนข้างยุ่งเหยิง
- ไม่มีระบบจัดการ state อย่าง Vuex หรือ Context API
- ไม่มีระบบ build หรือ bundler
- ระบบ Authentication ยังไม่ปลอดภัย (password ไม่ได้ hash)
- ยังไม่มีส่วนของ Admin Dashboard และ Owner Dashboard ใน PWA
- ยังไม่มีระบบ Export PDF อัตโนมัติ
- ยังไม่มีระบบ Query/Filter อัตโนมัติใน Google Sheets

## 10. สรุป

โปรเจค Mangpong Trading PWA มีพื้นฐานที่ดีและเหมาะสมกับเป้าหมายที่วางไว้ โดยเฉพาะในส่วนของแมสเซ็นเจอร์ที่สามารถใช้งานบนมือถือได้ดี แต่ยังขาดระบบสำหรับพนักงานและเจ้าของในส่วนของ PWA ซึ่งจำเป็นต้องพัฒนาเพิ่มเติมเพื่อให้ครบตามความต้องการทั้งหมดที่ระบุไว้.